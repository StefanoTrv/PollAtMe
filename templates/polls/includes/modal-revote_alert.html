<div class="modal fade" id="modalAlertPollRevote" tabindex="-1" aria-labelledby="modalAlertPollRevoteLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Sei sicuro?</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modal-body">
            <p id="text"></p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Indietro</button>
            <button id="saveModal" type="click" class="btn btn-primary">Conferma</button>
        </div>
      </div>
    </div>
</div>


<script>
    var alertModal = document.getElementById('modalAlertPollRevote');
    var p = document.getElementById('text');
    if ('{{revote_type}}' == 'single_preference') {
        alertModal.addEventListener('show.bs.modal', event => {
          p.innerHTML = "Prima hai scelto <b>{{ request.session.alternative_sp }}</b> e ora hai dato ad almeno un'altra alternativa un giudizio migliore rispetto a <b>{{ request.session.alternative_sp }}</b>. Vuoi confermare comunque il rivoto?";
      })
    } else {
      var modalbody = document.getElementById('modal-body')
      var giudizi = {'1': 'Pessimo', '2': 'Scarso', '3': 'Sufficiente', '4': 'Buono', '5': 'Ottimo'}
      alertModal.addEventListener('show.bs.modal', event => {
        p.innerHTML = "È stata rilevata un'incongruenza, evidenziata nella tabella sottostante, tra l'ordinamento dato con il metodo Schulze e quello che è possibile desumere dai giudizi. Vuoi cambiare giudizi?";
        
        //table creation
        var tbl = document.createElement("table")
        tbl.setAttribute('style', 'width:100%; margin: 0 auto')
        tbl.setAttribute("class", "table table-striped")

        //head table
        var thead = document.createElement("thead")
        var tr = document.createElement("tr")
        var td1 = document.createElement("td")
        var td2 = document.createElement("td")
        td1.appendChild(document.createTextNode("Ordinamento Schulze"))
        td2.appendChild(document.createTextNode("Giudizi"))
        tr.appendChild(td1)
        tr.appendChild(td2)
        thead.appendChild(tr)
        tbl.appendChild(thead)
        
        //body
        var tblBody = document.createElement("tbody");
        var sequence_shultze = `{{sequence_shultze|safe}}`.replaceAll('\'', '').slice(1, -1).split(', ')
        var tbl_length = sequence_shultze.length
        var inconsistency1 = localStorage.key(0)
        var inconsistency2 = localStorage.key(1)
        console.log(inconsistency1 + " " + inconsistency2)
        for (var j = 0; j < tbl_length; j++) {
          var row = document.createElement("tr")
          row.setAttribute("id", sequence_shultze[j])
          var row_id = row.getAttribute("id")

          var cell1 = document.createElement("td");
          var cellText1 = document.createTextNode(sequence_shultze[j]);

          if (row_id == inconsistency1){
            row.style.backgroundColor = "#F58770"
            var cell2 = document.createElement("td");
            var cellText2 = document.createTextNode(giudizi[localStorage.getItem(inconsistency1)]);
            cell1.appendChild(cellText1)
            cell2.appendChild(cellText2);
            row.appendChild(cell1);
            row.appendChild(cell2);
          } else if (row_id == inconsistency2){
            console.log(row_id + " " + inconsistency2 + " " + j)
            row.style.backgroundColor = "#F58770"
            var cell2 = document.createElement("td");
            var cellText2 = document.createTextNode(giudizi[localStorage.getItem(inconsistency2)]);
            cell1.appendChild(cellText1)
            cell2.appendChild(cellText2);
            row.appendChild(cell1);
            row.appendChild(cell2);
          } else {
            cell1.appendChild(cellText1)
            row.appendChild(cell1);
            var cell2 = document.createElement("td");
            var cellText2 = document.createTextNode(". . .");
            cell2.appendChild(cellText2);
            row.appendChild(cell2);
          }
          tblBody.appendChild(row);
        }
        
        tbl.appendChild(tblBody)
        tbl.setAttribute("border", "2");
        modalbody.appendChild(tbl)
      })
      alertModal.addEventListener('hide.bs.modal', event => {
        localStorage.clear()
        modalbody.removeChild(modalbody.lastChild)
      })
    }
    var saveModal = document.getElementById('saveModal');
    saveModal.addEventListener('click', event => {
      document.getElementById('vote-form').submit()
    })
</script>